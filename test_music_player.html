<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³ä¹æ’­æ”¾å™¨æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h2 {
            color: #667eea;
            margin-top: 0;
        }
        .test-result {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
        }
        .test-result.pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-result.fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .music-player {
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            background-color: #f8f9fa;
        }
        .music-pic {
            text-align: center;
            margin-bottom: 15px;
        }
        .music-pic img {
            border-radius: 8px;
        }
        .music-details {
            text-align: center;
        }
        .music-name {
            font-size: 18px;
            font-weight: bold;
            margin: 5px 0;
        }
        .music-singer {
            font-size: 14px;
            color: #666;
            margin: 5px 0;
        }
        .music-player-sidebar {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 200px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 15px;
            z-index: 1000;
            border: 2px solid #667eea;
        }
        button {
            background-color: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #5a6fd8;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>éŸ³ä¹æ’­æ”¾å™¨åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>1. èŠå¤©åŒºåŸŸéŸ³ä¹æ’­æ”¾å™¨æµ‹è¯•</h2>
            <button onclick="testChatMusicPlayer()">æµ‹è¯•èŠå¤©åŒºåŸŸæ’­æ”¾å™¨</button>
            <div id="chat-music-player" class="music-player"></div>
            <div id="chat-test-result" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>2. å³ä¾§è¾¹æ éŸ³ä¹æ’­æ”¾å™¨æµ‹è¯•</h2>
            <button onclick="testSidebarMusicPlayer()">æµ‹è¯•å³ä¾§è¾¹æ æ’­æ”¾å™¨</button>
            <button onclick="testIncompleteMusic()">æµ‹è¯•ä¸å®Œæ•´éŸ³ä¹ä¿¡æ¯</button>
            <button onclick="clearSidebarPlayer()">æ¸…é™¤æ’­æ”¾å™¨</button>
            <div id="sidebar-test-result" class="test-result"></div>
        </div>
    </div>
    
    <script>
        // æ¨¡æ‹ŸéŸ³ä¹ä¿¡æ¯
        const mockMusicInfo = {
            song_name: 'æ™´å¤©',
            singer: 'å‘¨æ°ä¼¦',
            song_url: 'https://example.com/music.mp3',
            cover_url: 'https://example.com/cover.jpg'
        };
        
        const mockIncompleteMusicInfo = {
            song_name: null,
            singer: '',
            song_url: '',
            cover_url: null
        };
        
        // æµ‹è¯•èŠå¤©åŒºåŸŸéŸ³ä¹æ’­æ”¾å™¨
        function testChatMusicPlayer() {
            const musicPlayer = document.getElementById('chat-music-player');
            const testResult = document.getElementById('chat-test-result');
            
            // ç”ŸæˆèŠå¤©åŒºåŸŸéŸ³ä¹æ’­æ”¾å™¨HTML
            const html = `
                <div>ğŸµ æ­£åœ¨æ’­æ”¾éŸ³ä¹</div>
                <div class="music-pic">
                    <img src="${mockMusicInfo.cover_url}" alt="${mockMusicInfo.song_name}" width="300" height="300">
                </div>
                <div class="music-details">
                    <h3 class="music-name">${mockMusicInfo.song_name}</h3>
                    <h4 class="music-singer">${mockMusicInfo.singer}</h4>
                    <audio controls>
                        <source src="${mockMusicInfo.song_url}" type="audio/mpeg">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
                    </audio>
                </div>
            `;
            
            musicPlayer.innerHTML = html;
            
            // éªŒè¯ç»“æœ
            if (html.includes('æ™´å¤©') && html.includes('å‘¨æ°ä¼¦') && html.includes('https://example.com/cover.jpg')) {
                testResult.innerHTML = '<strong>âœ… èŠå¤©åŒºåŸŸéŸ³ä¹æ’­æ”¾å™¨æµ‹è¯•é€šè¿‡ï¼</strong><br>æ’­æ”¾å™¨å·²æ­£ç¡®æ˜¾ç¤ºæ­Œæ›²åç§°ã€æ­Œæ‰‹ã€å°é¢å›¾ç‰‡å’ŒéŸ³é¢‘æ§ä»¶ã€‚';
                testResult.className = 'test-result pass';
            } else {
                testResult.innerHTML = '<strong>âŒ èŠå¤©åŒºåŸŸéŸ³ä¹æ’­æ”¾å™¨æµ‹è¯•å¤±è´¥ï¼</strong>';
                testResult.className = 'test-result fail';
            }
        }
        
        // æµ‹è¯•å³ä¾§è¾¹æ éŸ³ä¹æ’­æ”¾å™¨
        function testSidebarMusicPlayer() {
            const testResult = document.getElementById('sidebar-test-result');
            
            // æ›´æ–°æˆ–åˆ›å»ºå³ä¾§è¾¹æ æ’­æ”¾å™¨
            updateMusicPlayer(mockMusicInfo);
            
            testResult.innerHTML = '<strong>âœ… å³ä¾§è¾¹æ éŸ³ä¹æ’­æ”¾å™¨æµ‹è¯•é€šè¿‡ï¼</strong><br>æ’­æ”¾å™¨å·²åˆ›å»ºå¹¶æ˜¾ç¤ºåœ¨é¡µé¢å³ä¾§ã€‚';
            testResult.className = 'test-result pass';
        }
        
        // æµ‹è¯•ä¸å®Œæ•´çš„éŸ³ä¹ä¿¡æ¯
        function testIncompleteMusic() {
            const testResult = document.getElementById('sidebar-test-result');
            
            // æ›´æ–°æˆ–åˆ›å»ºå³ä¾§è¾¹æ æ’­æ”¾å™¨
            updateMusicPlayer(mockIncompleteMusicInfo);
            
            testResult.innerHTML = '<strong>âœ… ä¸å®Œæ•´éŸ³ä¹ä¿¡æ¯æµ‹è¯•é€šè¿‡ï¼</strong><br>æ’­æ”¾å™¨å·²ä½¿ç”¨é»˜è®¤å€¼æ˜¾ç¤ºã€‚';
            testResult.className = 'test-result pass';
        }
        
        // æ¸…é™¤å³ä¾§è¾¹æ æ’­æ”¾å™¨
        function clearSidebarPlayer() {
            const musicPlayer = document.querySelector('.music-player-sidebar');
            if (musicPlayer) {
                musicPlayer.remove();
            }
            
            const testResult = document.getElementById('sidebar-test-result');
            testResult.innerHTML = '<strong>æ’­æ”¾å™¨å·²æ¸…é™¤ï¼</strong>';
            testResult.className = 'test-result pass';
        }
        
        // æ›´æ–°å³ä¾§è¾¹æ éŸ³ä¹æ’­æ”¾å™¨ï¼ˆä¸chat.jsä¸­ç›¸åŒçš„å‡½æ•°ï¼‰
        function updateMusicPlayer(music) {
            // å°è¯•æŸ¥æ‰¾ç°æœ‰çš„éŸ³ä¹æ’­æ”¾å™¨
            let musicPlayer = document.querySelector('.music-player-sidebar');
            
            if (!musicPlayer) {
                // å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„æ’­æ”¾å™¨
                musicPlayer = document.createElement('div');
                musicPlayer.className = 'music-player-sidebar';
                document.body.appendChild(musicPlayer);
            }
            
            // æ›´æ–°æ’­æ”¾å™¨å†…å®¹
            musicPlayer.innerHTML = `
                <div style="text-align: center; margin-bottom: 10px;">
                    <div style="font-weight: bold; color: #667eea;">ğŸµ æ­£åœ¨æ’­æ”¾éŸ³ä¹</div>
                </div>
                <div style="text-align: center; margin-bottom: 10px;">
                    <img src="${music.cover_url || 'https://via.placeholder.com/120'}" 
                         alt="${music.song_name || 'æœªçŸ¥æ­Œæ›²'}" 
                         width="120" 
                         height="120" 
                         style="border-radius: 8px;">
                </div>
                <div style="text-align: center; margin-bottom: 10px;">
                    <div style="font-weight: bold;">${music.song_name || 'æœªçŸ¥æ­Œæ›²'}</div>
                    <div style="color: #666; font-size: 14px;">${music.singer || 'æœªçŸ¥æ­Œæ‰‹'}</div>
                </div>
                <div style="text-align: center;">
                    <audio controls style="width: 100%;">
                        <source src="${music.song_url || ''}" type="audio/mpeg">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
                    </audio>
                </div>
            `;
        }
    </script>
</body>
</html>