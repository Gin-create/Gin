<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天气信息</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            padding: 15px;
        }
        
        .weather-card {
            width: 100%;
            height: 100%;
            max-width: 400px;
            max-height: 400px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            padding: 20px;
            color: white;
            overflow-y: auto;
        }
        
        .weather-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 15px;
        }
        
        .city-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .weather-info {
            margin-bottom: 20px;
        }
        
        .weather-day {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .date {
            font-size: 16px;
        }
        
        .day {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .temp-range {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .high-temp {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .low-temp {
            color: #4ecdc4;
        }
        
        .weather-condition {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .weather-text {
            font-size: 14px;
        }
        
        .wind-info {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .real-time-weather {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .real-time-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .hourly-weather {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 10px;
        }
        
        .hourly-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            min-width: 60px;
            text-align: center;
            font-size: 12px;
        }
        
        .hour-time {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .hour-temp {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .hour-desc {
            opacity: 0.9;
            font-size: 11px;
        }
        
        .error-message {
            text-align: center;
            padding: 40px 20px;
            color: #ff6b6b;
            font-size: 16px;
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="weather-card">
        <div id="weather-content">
            <!-- 天气信息将通过JavaScript动态加载 -->
            <div class="weather-header">
                <div class="city-name">加载中...</div>
            </div>
            <div class="error-message">
                正在获取天气信息，请稍候...
            </div>
        </div>
    </div>

    <script>
        // 获取URL参数中的城市名称
        function getUrlParam(name) {
            const reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)');
            const r = window.location.search.substr(1).match(reg);
            if (r != null) return decodeURIComponent(r[2]);
            return null;
        }

        // 获取天气信息
        async function getWeather() {
            const city = getUrlParam('city');
            if (!city) {
                document.getElementById('weather-content').innerHTML = `
                    <div class="weather-header">
                        <div class="city-name">错误</div>
                    </div>
                    <div class="error-message">
                        缺少城市参数
                    </div>
                `;
                return;
            }

            try {
                // 从后端获取天气数据
                const response = await fetch(`/weather?city=${encodeURIComponent(city)}`);
                const data = await response.json();

                if (data.code !== 200) {
                    document.getElementById('weather-content').innerHTML = `
                        <div class="weather-header">
                            <div class="city-name">${city}</div>
                        </div>
                        <div class="error-message">
                            ${data.msg || '获取天气信息失败'}
                        </div>
                    `;
                    return;
                }

                // 渲染天气信息
                renderWeather(data);
            } catch (error) {
                document.getElementById('weather-content').innerHTML = `
                    <div class="weather-header">
                        <div class="city-name">${city}</div>
                    </div>
                    <div class="error-message">
                        网络错误：${error.message}
                    </div>
                `;
            }
        }

        // 渲染天气信息
        function renderWeather(data) {
            const city = data.data.city;
            const weatherData = data.data.data;

            let html = `
                <div class="weather-header">
                    <div class="city-name">${city}</div>
                </div>
            `;

            // 渲染每日天气
            weatherData.forEach(day => {
                html += `
                    <div class="weather-day">
                        <div class="day-header">
                            <span class="date">${day.date}</span>
                            <span class="day">${day.day}</span>
                        </div>
                        <div class="temp-range">
                            <span class="high-temp">${day.high_temp}°C</span>
                            <span class="low-temp">${day.low_temp}°C</span>
                        </div>
                        <div class="weather-condition">
                            <span class="weather-text">${day.weather_from} - ${day.weather_to}</span>
                        </div>
                        <div class="wind-info">
                            ${day.wind_from} ${day.wind_level_from} - ${day.wind_to} ${day.wind_level_to}
                        </div>
                        
                        <!-- 渲染实时天气 -->
                        <div class="real-time-weather">
                            <div class="real-time-title">实时天气</div>
                            <div class="hourly-weather">
                `;

                // 渲染每小时天气
                day.real_time_weather.forEach(hour => {
                    html += `
                        <div class="hourly-item">
                            <div class="hour-time">${hour.time}</div>
                            <div class="hour-temp">${hour.temperature}°C</div>
                            <div class="hour-desc">${hour.weather}</div>
                        </div>
                    `;
                });

                html += `
                            </div>
                        </div>
                    </div>
                `;
            });

            document.getElementById('weather-content').innerHTML = html;
        }

        // 页面加载时获取天气信息
        window.onload = getWeather;
    </script>
</body>
</html>